# ğŸŒ¸ AstrBot æ´»è·ƒæˆå‘˜æŠ½è€å©†æ’ä»¶

åŸºäº [AstrBot](https://github.com/Soulter/AstrBot) çš„ç¾¤èŠäº’åŠ¨æ’ä»¶ã€‚é€šè¿‡è®°å½•ç¾¤å†…æ´»è·ƒæˆå‘˜ï¼ˆ30å¤©å†…å‘è¨€çš„ç”¨æˆ·ï¼‰ï¼Œå®ç°éšæœºæŠ½å–â€œä»Šæ—¥è€å©†â€çš„åŠŸèƒ½ï¼Œå¹¶ç”Ÿæˆç¾¤å†…æˆå‘˜é—´çš„ç¾ç»Šå…³ç³»å›¾è°±ã€‚

## âœ¨ åŠŸèƒ½äº®ç‚¹

* **æ´»è·ƒç­›é€‰**ï¼šä»…ä» 30 å¤©å†…æœ‰å‘è¨€è®°å½•çš„â€œæ´»äººâ€ä¸­æŠ½å–ï¼Œè‡ªåŠ¨è¿‡æ»¤æœºå™¨äººä¸ ID ä¸º 0 çš„å¼‚å¸¸è´¦å·ã€‚
* **å¤´åƒå±•ç¤º**ï¼šæŠ½å–ç»“æœé™„å¸¦ 640px é«˜æ¸… QQ å¤´åƒï¼Œè§†è§‰ä½“éªŒæ›´ä½³ã€‚
* **å¯è§†åŒ–å…³ç³»**ï¼šåŸºäº `Vis.js` æ¸²æŸ“ç”Ÿæˆé«˜æ¸…å…³ç³»ç½‘ç»œå›¾ï¼Œç›´è§‚å±•ç¤ºç¾¤å†…â€œé”™ç»¼å¤æ‚â€çš„è€å©†å…³ç³»ã€‚
* **æ™ºèƒ½åç§°è¯†åˆ«**ï¼šå›¾è°±è‡ªåŠ¨å…³è”ç”¨æˆ·æ˜µç§°ï¼Œä¼˜å…ˆæ˜¾ç¤ºè€å©†åè€Œéæ•°å­— IDã€‚
* **çµæ´»ç®¡æ§**ï¼šæ”¯æŒ **ç¾¤èŠç™½åå•** å’Œ **é»‘åå•**ï¼Œä»¥åŠæ¯äººæ¯æ—¥æŠ½å–æ¬¡æ•°é™åˆ¶ã€‚


## ğŸ® ä½¿ç”¨æŒ‡ä»¤

| æŒ‡ä»¤ | åˆ«ç§° | æƒé™ | è¯´æ˜ |
| --- | --- | --- | --- |
| `/ä»Šæ—¥è€å©†` | `æŠ½è€å©†` | ç”¨æˆ· | éšæœºæŠ½å–ä¸€åä»Šæ—¥è€å©† |
| `/å¼ºå¨¶ @ç”¨æˆ·` | `å¼ºå¨¶` | ç”¨æˆ· | æ¶ˆè€—æ¬¡æ•°å¼ºåˆ¶ä¸æŒ‡å®šç”¨æˆ·å»ºç«‹ç¾ç»Š |
| `/å…³ç³»å›¾` | `ç¾ç»Šå›¾è°±` | ç”¨æˆ· | ç”Ÿæˆå¹¶å‘é€æœ¬ç¾¤ä»Šæ—¥çš„è€å©†å…³ç³»ç½‘ç»œå›¾ |
| `/æˆ‘çš„è€å©†` | `æŠ½å–å†å²` | ç”¨æˆ· | æŸ¥çœ‹ä»Šå¤©æŠ½åˆ°çš„è®°å½•åŠæ¬¡æ•° |
| `/é‡ç½®è®°å½•` | - |ç®¡ç†å‘˜| æ¸…ç©ºæ‰€æœ‰ä»Šæ—¥æŠ½å–è®°å½• |
| `/é‡ç½®å¼ºå¨¶æ—¶é—´` | - | ç®¡ç†å‘˜ | æ¸…ç©ºå½“å‰ç¾¤çš„å¼ºå¨¶æ—¶é—´æˆ³ |
| `/rbqæ’è¡Œ` | - | ç”¨æˆ· | å±•ç¤ºè¿‘30å¤©è¢«å¼ºå¨¶çš„æ¬¡æ•°æ’è¡Œï¼ˆåªæ˜¾ç¤ºå‰10åï¼‰ |
| `/æŠ½è€å©†å¸®åŠ©` | - | ç”¨æˆ· | æŸ¥çœ‹è¯¦ç»†æŒ‡ä»¤è¯´æ˜ |

> è‹¥åœ¨æ’ä»¶é…ç½®ä¸­å¼€å¯ `keyword_trigger_enabled`ï¼Œåˆ™ä¹Ÿå¯ç›´æ¥å‘é€å…³é”®è¯ï¼ˆå¦‚ï¼š`æŠ½è€å©†`ã€`å¼ºå¨¶`ã€`å…³ç³»å›¾`ã€`æŠ½è€å©†å¸®åŠ©`ï¼‰è§¦å‘ï¼Œæ— éœ€æŒ‡ä»¤å‰ç¼€ã€‚
> å…³é”®è¯è§¦å‘åŒæ ·éµå¾ªæƒé™æ§åˆ¶ï¼šä¾‹å¦‚ `é‡ç½®è®°å½•`ã€`é‡ç½®å¼ºå¨¶æ—¶é—´` ä»ä»…ç®¡ç†å‘˜å¯ç”¨ã€‚
> è‹¥åœ¨ AstrBot æŒ‡ä»¤ç®¡ç†ä¸­æŠŠæŸæ¡æŒ‡ä»¤è®¾ä¸ºâ€œå·²ç¦ç”¨â€ï¼Œå¯¹åº”å…³é”®è¯è§¦å‘ä¹Ÿä¼šåŒæ­¥å¤±æ•ˆã€‚

## åŠŸèƒ½æ¼”ç¤º
![ç¾¤å†…å…³ç³»å›¾](pic/å…³ç³»å›¾.jpg)
![å¼ºå¨¶æ¼”ç¤ºå›¾](pic/æ¼”ç¤ºå›¾2.png)
![è¢«å¼ºå¨¶æ’è¡Œæ¼”ç¤ºå›¾](pic/ç¾¤rbqæ’è¡Œå›¾.jpg)

## ğŸ› ï¸ å®‰è£…ç¯å¢ƒè¦æ±‚

æœ¬æ’ä»¶çš„å…³ç³»å›¾åŠŸèƒ½ä¾èµ–äº AstrBot çš„æµè§ˆå™¨æ¸²æŸ“å¼•æ“ï¼šï¼ˆä¸€èˆ¬è‡ªå¸¦ï¼Œä¸ç”¨å¦å¤–è£…ï¼‰

1. è¯·ç¡®ä¿ä½ çš„ AstrBot ç¯å¢ƒå·²æ­£ç¡®å®‰è£… `Playwright` æµè§ˆå™¨é©±åŠ¨ã€‚
2. æ’ä»¶ç›®å½•ä¸‹éœ€åŒ…å« `graph_template.html` æ¨¡æ¿æ–‡ä»¶ã€‚
3. æ¸²æŸ“è¿‡ç¨‹éœ€è¦è”ç½‘åŠ è½½ `Vis.js` åº“ï¼ˆå·²ä¼˜åŒ–ä½¿ç”¨å›½å†…é«˜é€Ÿ CDNï¼‰ã€‚

## âš™ï¸ é…ç½®é¡¹è¯´æ˜

åœ¨ AstrBot ç®¡ç†é¢æ¿æˆ– `_conf_schema.json` ä¸­å¯é…ç½®ä»¥ä¸‹å†…å®¹ï¼š

| é…ç½®é”® | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| --- | --- | --- | --- |
| `daily_limit` | int | 1 | æ¯äººæ¯å¤©å¯æŠ½å–çš„æ¬¡æ•°ä¸Šé™ |
| `max_records` | int | 500 | å…¨å±€ JSON å­˜å‚¨çš„æœ€å¤§è®°å½•æ¡æ•° |
| `excluded_users` | list | [] | æ°¸è¿œä¸ä¼šè¢«æŠ½ä¸­çš„ QQ å·åˆ—è¡¨ï¼ˆç”¨äºâ€œä»Šæ—¥è€å©†â€ï¼‰ |
| `force_marry_excluded_users` | list | [] | å¼ºå¨¶æ’é™¤ç”¨æˆ·åˆ—è¡¨ï¼ˆåœ¨æ­¤åˆ—è¡¨ä¸­çš„ QQ å·ä¸èƒ½è¢«å¼ºå¨¶ï¼‰ |
| `whitelist_groups` | list | [] | ç™½åå•æ¨¡å¼ï¼šä»…åœ¨æ­¤åˆ—è¡¨ä¸­çš„ç¾¤ç”Ÿæ•ˆ |
| `blacklist_groups` | list | [] | é»‘åå•æ¨¡å¼ï¼šåˆ—è¡¨ä¸­çš„ç¾¤å°†ç¦ç”¨æ’ä»¶ |
| `keyword_trigger_enabled` | bool | false | æ˜¯å¦å¯ç”¨â€œå…³é”®è¯è§¦å‘â€ï¼ˆæ— éœ€ `/` å‰ç¼€ï¼‰ |
| `keyword_trigger_mode` | string | exact | å…³é”®è¯åŒ¹é…æ¨¡å¼ï¼š`exact` / `starts_with` / `contains` |
| `auto_set_other_half` | bool | false | è‡ªåŠ¨è®¾ç½®å¯¹æ–¹è€å©†ï¼ˆå¯¹æ–¹å½“å¤©æ— è®°å½•æ—¶æ‰ä¼šç”Ÿæ•ˆï¼‰ |
| `auto_withdraw_enabled` | bool | false | å®šæ—¶è‡ªåŠ¨æ’¤å›ï¼ˆä»… aiocqhttp/OneBot å¯ç”¨ï¼‰ |
| `auto_withdraw_delay_seconds` | int | 5 | è‡ªåŠ¨æ’¤å›å»¶è¿Ÿç§’æ•° |

## ğŸ§© é‡æ„åçš„æ¨¡å—ç»“æ„

ä¸ºäº†æå‡æ‰©å±•æ€§ä¸å¯ç»´æŠ¤æ€§ï¼Œå½“å‰ç‰ˆæœ¬å·²å°† `main.py` çš„å¤§éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘æ‹†åˆ†åˆ°åˆ†å±‚æ¨¡å—ï¼š

- `main.py`ï¼šæ’ä»¶å…¥å£ã€AstrBot è£…é¥°å™¨è·¯ç”±ã€ä¾èµ–è£…é…ã€‚
- `constants.py`ï¼šé»˜è®¤å…³é”®è¯è·¯ç”±å¸¸é‡ã€‚
- `core/config_accessor.py`ï¼šé…ç½®è¯»å–ä¸ç±»å‹å…œåº•ã€‚
- `core/data_store.py`ï¼šJSON æŒä¹…åŒ–ã€è®°å½•è£å‰ªã€RBQ ç»Ÿè®¡æ¸…ç†ã€‚
- `core/onebot_gateway.py`ï¼šNapCat/OneBot API é€‚é…ä¸å“åº”è§£åŒ…ã€‚
- `services/activity_service.py`ï¼šæ´»è·ƒç”¨æˆ·è®°å½•ä¸æ¸…ç†ã€‚
- `services/keyword_dispatch_service.py`ï¼šå…³é”®è¯è§¦å‘åŒ¹é…ã€æƒé™/å¯ç”¨æ ¡éªŒã€‚
- `services/wife_command_service.py`ï¼šæŠ½è€å©†/å¼ºå¨¶/å…³ç³»å›¾/æ’è¡Œç­‰å‘½ä»¤ä¸šåŠ¡ã€‚

> æŒ‡ä»¤ã€é…ç½®é”®ä¸å­˜å‚¨æ•°æ®æ ¼å¼ä¿æŒå…¼å®¹ï¼Œä¸å½±å“å·²æœ‰éƒ¨ç½²æ•°æ®ã€‚

## ğŸ”§ å¼€å‘ä¸éªŒè¯

å»ºè®®åœ¨æœ¬æ’ä»¶ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
python3 -m unittest discover -s tests -p "test_*.py"
ruff check .
python3 -m compileall main.py core services
```
